<div class="page-header">
  <h1><%= @video.title %></h1>
  <div class="actions">
    <% if can_write? %>
      <%= link_to "Edit", edit_video_path(@video), class: "btn btn-secondary" %>
      <%= link_to "Delete", @video, data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this video?" }, class: "btn btn-danger" %>
    <% end %>
    <%= link_to "Back to Videos", videos_path, class: "btn btn-primary" %>
  </div>
</div>

<div class="video-show-container">
  <div class="video-player-section">
    <% if @video.youtube_embed_url %>
      <div class="video-player">
        <iframe
          width="100%"
          height="400"
          src="<%= @video.youtube_embed_url %>"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          loading="lazy">
        </iframe>
      </div>
    <% elsif @video.vimeo_embed_url %>
      <div class="video-player">
        <iframe
          src="<%= @video.vimeo_embed_url %>"
          width="100%"
          height="400"
          frameborder="0"
          allow="autoplay; fullscreen; picture-in-picture"
          allowfullscreen
          loading="lazy">
        </iframe>
      </div>
    <% elsif @video.other_url.present? %>
      <div class="no-player">
        <p>External video:</p>
        <%= link_to @video.other_url, @video.other_url, target: "_blank", rel: "noopener noreferrer", class: "btn btn-primary" %>
      </div>
    <% else %>
      <div class="no-player">
        <p>No video URL available.</p>
      </div>
    <% end %>
  </div>

  <div class="video-details">
    <div class="card">
      <div class="detail-grid">
        <% if @video.video_type.present? %>
          <div class="detail-item">
            <label>Type</label>
            <div class="value"><%= @video.type_display %></div>
          </div>
        <% end %>

        <% if @video.creator.present? %>
          <div class="detail-item">
            <label>Creator</label>
            <div class="value"><%= @video.creator %></div>
          </div>
        <% end %>

        <% if @video.source.present? %>
          <div class="detail-item">
            <label>Source</label>
            <div class="value"><%= @video.source %></div>
          </div>
        <% end %>

        <% if @video.duration.present? %>
          <div class="detail-item">
            <label>Duration</label>
            <div class="value"><%= @video.duration %></div>
          </div>
        <% end %>

        <% if @video.publication_date.present? %>
          <div class="detail-item">
            <label>Published</label>
            <div class="value"><%= @video.date_display %></div>
          </div>
        <% end %>
      </div>
    </div>

    <% if @video.notes.present? %>
      <div class="detail-section">
        <h2>Notes</h2>
        <div class="card">
          <p><%= simple_format(@video.notes) %></p>
        </div>
      </div>
    <% end %>

    <div class="detail-section">
      <h2>External Links</h2>
      <div class="card">
        <div class="external-links">
          <% if @video.youtube_url.present? %>
            <p>
              <strong>YouTube:</strong>
              <%= link_to "Watch on YouTube", @video.youtube_url, target: "_blank", rel: "noopener noreferrer" %>
            </p>
          <% end %>
          <% if @video.vimeo_url.present? %>
            <p>
              <strong>Vimeo:</strong>
              <%= link_to "Watch on Vimeo", @video.vimeo_url, target: "_blank", rel: "noopener noreferrer" %>
            </p>
          <% end %>
          <% if @video.other_url.present? %>
            <p>
              <strong>Other:</strong>
              <%= link_to @video.other_url, @video.other_url, target: "_blank", rel: "noopener noreferrer" %>
            </p>
          <% end %>
        </div>
      </div>
    </div>

    <% if @video.characters.any? %>
      <div class="detail-section">
        <h2>People in this Video (<%= @video.characters.count %>)</h2>
        <div class="card">
          <div class="tag-list">
            <% @video.characters.by_name.each do |character| %>
              <%= link_to character.name, character, class: "tag tag-character" %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>

    <% if @video.entries.any? %>
      <div class="detail-section">
        <h2>Related Events (<%= @video.entries.count %>)</h2>
        <% @video.entries.chronological.each do |entry| %>
          <div class="card source-card">
            <div class="source-header">
              <strong><%= link_to entry.title, entry %></strong>
              <% if entry.entry_type.present? %>
                <span class="tag tag-type"><%= entry.entry_type.titleize %></span>
              <% end %>
            </div>
            <p class="source-pages"><%= entry.date_display %></p>
          </div>
        <% end %>
      </div>
    <% end %>

    <% if @video.assets.any? %>
      <div class="detail-section">
        <h2>Assets Featured (<%= @video.assets.count %>)</h2>
        <div class="card">
          <div class="tag-list">
            <% @video.assets.by_name.each do |asset| %>
              <%= link_to asset.name, asset, class: "tag tag-asset" %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>

    <% if @video.locations.any? %>
      <div class="detail-section">
        <h2>Locations (<%= @video.locations.count %>)</h2>
        <div class="card">
          <div class="tag-list">
            <% @video.locations.by_name.each do |location| %>
              <%= link_to location.name, location, class: "tag tag-location" %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
