<div class="page-header">
  <h1>Members</h1>
  <p class="page-subtitle">Invite editors (can edit) or observers (read-only) to this timeline.</p>
</div>

<div class="card">
  <h2>Invite Member</h2>
  <%= form_with url: members_path, scope: :member, local: true do |f| %>
    <% if @member&.errors&.any? %>
      <div class="error-messages">
        <h3><%= pluralize(@member.errors.count, "error") %> prevented the invite:</h3>
        <ul>
          <% @member.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <% selected_role = params.dig(:member, :role).presence || "observer" %>

    <div class="form-row">
      <div class="form-group">
        <%= f.label :email, "Email" %>
        <%= f.email_field :email, placeholder: "observer@example.com" %>
      </div>
      <div class="form-group">
        <%= f.label :role, "Access" %>
        <%= f.select :role,
                     options_for_select([
                       [ "Observer (read-only)", "observer" ],
                       [ "Editor (can edit)", "editor" ]
                     ], selected_role) %>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <%= f.label :password, "Password (new users only)" %>
        <%= f.password_field :password, placeholder: "Set a password" %>
      </div>
      <div class="form-group">
        <%= f.label :password_confirmation, "Confirm Password" %>
        <%= f.password_field :password_confirmation, placeholder: "Confirm password" %>
      </div>
    </div>

    <p class="form-hint">If the email already exists, password fields are ignored.</p>

    <div class="form-actions">
      <%= f.submit "Invite", class: "btn btn-gold" %>
    </div>
  <% end %>
</div>

<div class="detail-section">
  <h2>Current Members (<%= @memberships.count + 1 %>)</h2>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Email</th>
          <th>Role</th>
          <th>Added</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><%= current_account.owner.email %></td>
          <td><span class="tag">Owner</span></td>
          <td><%= current_account.created_at.strftime("%b %d, %Y") %></td>
        </tr>
        <% @memberships.each do |membership| %>
          <% member = membership.user %>
          <tr>
            <td><%= member.email %></td>
            <td><span class="tag"><%= membership.role.titleize %></span></td>
            <td><%= membership.created_at.strftime("%b %d, %Y") %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
