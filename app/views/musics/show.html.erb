<div class="page-header">
  <h1><%= @music.title %></h1>
  <div class="actions">
    <%= link_to "Edit", edit_music_path(@music), class: "btn btn-secondary" %>
    <%= link_to "Delete", @music, data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this music?" }, class: "btn btn-danger" %>
    <%= link_to "Back to Music Library", musics_path, class: "btn btn-primary" %>
  </div>
</div>

<div class="music-show-container">
  <div class="music-player-section">
    <% if @music.spotify_embed_url %>
      <div class="spotify-player">
        <iframe
          src="<%= @music.spotify_embed_url %>"
          width="100%"
          height="<%= @music.spotify_type == 'track' ? '152' : '352' %>"
          frameborder="0"
          allowtransparency="true"
          allow="encrypted-media"
          loading="lazy">
        </iframe>
      </div>
    <% end %>

    <% if @music.youtube_embed_url %>
      <div class="youtube-player">
        <iframe
          width="100%"
          height="315"
          src="<%= @music.youtube_embed_url %>"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          loading="lazy">
        </iframe>
      </div>
    <% end %>

    <% unless @music.has_player? %>
      <div class="no-player">
        <p>No streaming link available for this track.</p>
      </div>
    <% end %>
  </div>

  <div class="music-details">
    <div class="card">
      <div class="detail-grid">
        <% if @music.artist.present? %>
          <div class="detail-item">
            <label>Artist</label>
            <div class="value"><%= @music.artist %></div>
          </div>
        <% end %>

        <% if @music.composer.present? %>
          <div class="detail-item">
            <label>Composer</label>
            <div class="value"><%= @music.composer %></div>
          </div>
        <% end %>

        <% if @music.genre.present? %>
          <div class="detail-item">
            <label>Genre</label>
            <div class="value"><%= @music.genre.titleize %></div>
          </div>
        <% end %>

        <% if @music.era.present? %>
          <div class="detail-item">
            <label>Era</label>
            <div class="value"><%= @music.era %></div>
          </div>
        <% end %>

        <% if @music.mood.present? %>
          <div class="detail-item">
            <label>Mood</label>
            <div class="value"><%= @music.mood.titleize %></div>
          </div>
        <% end %>

        <% if @music.usage_type.present? %>
          <div class="detail-item">
            <label>Usage</label>
            <div class="value"><%= @music.usage_type.titleize %></div>
          </div>
        <% end %>
      </div>
    </div>

    <% if @music.notes.present? %>
      <div class="detail-section">
        <h2>Notes</h2>
        <div class="card">
          <p><%= simple_format(@music.notes) %></p>
        </div>
      </div>
    <% end %>

    <div class="detail-section">
      <h2>External Links</h2>
      <div class="card">
        <div class="external-links">
          <% if @music.spotify_url.present? %>
            <p>
              <strong>Spotify:</strong>
              <%= link_to "Open in Spotify", @music.spotify_url, target: "_blank", rel: "noopener noreferrer" %>
            </p>
          <% end %>
          <% if @music.youtube_url.present? %>
            <p>
              <strong>YouTube:</strong>
              <%= link_to "Watch on YouTube", @music.youtube_url, target: "_blank", rel: "noopener noreferrer" %>
            </p>
          <% end %>
          <% if @music.apple_music_url.present? %>
            <p>
              <strong>Apple Music:</strong>
              <%= link_to "Open in Apple Music", @music.apple_music_url, target: "_blank", rel: "noopener noreferrer" %>
            </p>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
