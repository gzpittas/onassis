<div class="page-header">
  <h1><%= @credit.title %></h1>
  <div class="actions">
    <% if can_write? %>
      <%= link_to "Edit", edit_credit_path(@credit), class: "btn btn-secondary" %>
      <%= link_to "Delete", @credit, data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this credit and all its candidates?" }, class: "btn btn-danger" %>
    <% end %>
    <%= link_to "Back to Credits", credits_path, class: "btn btn-primary" %>
  </div>
</div>

<% if @credit.description.present? %>
  <div class="card">
    <p><%= @credit.description %></p>
  </div>
<% end %>

<div class="detail-section">
  <h2>Candidates (<%= @credit_candidates.count %>)</h2>
  <% if @credit_candidates.any? %>
    <div class="grid">
      <% @credit_candidates.each do |candidate| %>
        <div class="card">
          <% if candidate.image_url.present? %>
            <div class="card-image">
              <%= link_to credit_credit_candidate_path(@credit, candidate) do %>
                <%= image_tag candidate.image_url, alt: candidate.person_name, loading: "lazy" %>
              <% end %>
            </div>
          <% end %>
          <div class="card-header">
            <h3 class="card-title"><%= link_to candidate.person_name, credit_credit_candidate_path(@credit, candidate) %></h3>
            <% if candidate.priority.present? %>
              <span class="tag">#<%= candidate.priority %></span>
            <% end %>
          </div>
          <div class="card-body">
            <% if candidate.imdb_url.present? %>
              <p><%= link_to "IMDb", candidate.imdb_url, target: "_blank", rel: "noopener noreferrer" %></p>
            <% end %>
            <% if candidate.notes.present? %>
              <p class="card-meta"><%= truncate(candidate.notes, length: 100) %></p>
            <% end %>
          </div>
          <% if can_write? %>
            <div class="card-footer">
              <%= link_to "Edit", edit_credit_credit_candidate_path(@credit, candidate), class: "btn btn-small btn-secondary" %>
              <%= link_to "Remove", credit_credit_candidate_path(@credit, candidate), data: { turbo_method: :delete, turbo_confirm: "Are you sure?" }, class: "btn btn-small btn-danger" %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="card-meta">No candidates yet for this credit.</p>
  <% end %>
  <% if can_write? %>
    <%= link_to "Add Candidate", new_credit_credit_candidate_path(@credit), class: "btn btn-secondary btn-small" %>
  <% end %>
</div>
