<div class="page-header">
  <h1>Production Credits</h1>
  <%= link_to "Add Credit", new_credit_path, class: "btn btn-gold" %>
</div>

<% if @credits.any? %>
  <div class="grid">
    <% @credits.each do |credit| %>
      <div class="card">
        <div class="card-header">
          <h3 class="card-title"><%= link_to credit.title, credit %></h3>
          <% if credit.priority.present? %>
            <span class="tag">#<%= credit.priority %></span>
          <% end %>
        </div>
        <div class="card-body">
          <% if credit.description.present? %>
            <p><%= truncate(credit.description, length: 150) %></p>
          <% end %>
          <% candidates_with_images = credit.credit_candidates.by_priority.select { |c| c.image_url.present? } %>
          <% if candidates_with_images.any? %>
            <div class="candidate-thumbnails">
              <% candidates_with_images.each do |candidate| %>
                <div class="candidate-thumbnail-item">
                  <%= link_to credit_credit_candidate_path(credit, candidate) do %>
                    <%= image_tag candidate.image_url, alt: candidate.person_name, class: "candidate-thumb", loading: "lazy" %>
                  <% end %>
                  <span class="candidate-thumb-name"><%= candidate.person_name %></span>
                </div>
              <% end %>
            </div>
          <% end %>
          <p class="card-meta"><%= credit.credit_candidates.count %> candidates</p>
        </div>
        <div class="card-footer">
          <%= link_to "View", credit, class: "btn btn-small btn-primary" %>
          <%= link_to "Edit", edit_credit_path(credit), class: "btn btn-small btn-secondary" %>
          <%= link_to "Delete", credit, data: { turbo_method: :delete, turbo_confirm: "Are you sure?" }, class: "btn btn-small btn-danger" %>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="empty-state">
    <h3>No Credits Yet</h3>
    <p>Start adding production credits like Director, Producer, Writer, etc.</p>
    <%= link_to "Add Your First Credit", new_credit_path, class: "btn btn-gold" %>
  </div>
<% end %>
